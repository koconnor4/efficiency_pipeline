

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; efficiency_pipeline 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic Functionality" href="examples/plot_package.html" />
    <link rel="prev" title="Installation" href="install.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> efficiency_pipeline
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="#using-your-own-data">Using Your Own Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="#effective-point-spread-function">Effective Point Spread Function</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/plot_package.html">Basic Functionality</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Primary Contributors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">efficiency_pipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="using-your-own-data">
<h1>Using Your Own Data<a class="headerlink" href="#using-your-own-data" title="Permalink to this headline">¶</a></h1>
<p>In order to measure the detection efficiency for your image data, you must open the fits files, <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.io.fits.open</span></code>. There is an LCO example provided for reference. In this example, we have a strongly lensed galaxy-galaxy system with image dirs (in the <code class="docutils literal notranslate"><span class="pre">efficiency_pipeline/lco_pipe_example/sdssj2309-0039/</span></code> folder)
<code class="docutils literal notranslate"><span class="pre">dia_out</span></code>, <code class="docutils literal notranslate"><span class="pre">dia_trim</span></code>, <code class="docutils literal notranslate"><span class="pre">source_im</span></code>, and a table of predicted peak lensed SNIa mags <code class="docutils literal notranslate"><span class="pre">peakGLSN.csv</span></code> . The directories contain the differences, single visit exposures, and the file which you’d like to do the analysis for. First we can read in these images (and that table) taking/printing the necessary values from source file header:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">,</span><span class="n">diff_image</span><span class="p">,</span><span class="n">ref_image</span><span class="p">,</span><span class="n">glsnID</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">lco_pipe_ex</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">~</span> <span class="n">cpt1m010</span><span class="o">-</span><span class="n">fa16</span><span class="o">-</span><span class="mi">20200816</span><span class="o">-</span><span class="mi">0229</span><span class="o">-</span><span class="n">e91_trim</span><span class="o">.</span><span class="n">fits</span> <span class="p">(</span><span class="n">groupid</span> <span class="n">SDSSJ2309</span><span class="o">-</span><span class="mi">0039</span><span class="p">)</span> <span class="n">has</span> <span class="n">L1fwhm</span> <span class="o">~</span> <span class="mf">1.491417758955098</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">pixscale</span> <span class="o">~</span> <span class="mf">0.389</span> <span class="n">arcsec</span><span class="o">/</span><span class="n">pixel</span><span class="p">,</span> <span class="ow">and</span> <span class="n">skybr</span> <span class="mf">21.9799995</span> <span class="n">mag</span><span class="o">/</span><span class="n">arcsec</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span> <span class="n">zp</span> <span class="o">~</span> <span class="mf">23.60843226612176</span>

<span class="n">glsn</span> <span class="o">~</span>
<span class="n">Source</span> <span class="n">ID</span>    <span class="n">Magnification</span> <span class="n">Lens</span> <span class="n">Z</span> <span class="n">Source</span> <span class="n">Z</span> <span class="n">Peak</span> <span class="n">Apparent</span> <span class="n">Magnitude</span>
<span class="o">--------------</span> <span class="o">-------------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">-----------------------</span>
<span class="n">SDSSJ2309</span><span class="o">-</span><span class="mi">0039</span>             <span class="mi">4</span>   <span class="mf">0.29</span>      <span class="mf">1.0</span>             <span class="mf">23.22508768</span>
</pre></div>
</div>
</div>
<div class="section" id="effective-point-spread-function">
<h1>Effective Point Spread Function<a class="headerlink" href="#effective-point-spread-function" title="Permalink to this headline">¶</a></h1>
<p>The first step is to find the stars in the image…</p>
<p>All sources can be found applying several photutil helpers, detection threshold is set using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.detection.detect_threshold</span></code>, sources above the threshold value return a segmentation image object using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.segmentation.detect_sources</span></code>, the image background is determined using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.background.Background2D</span></code>, and finally photometric and morphological properties of the background subtracted image are determined using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.segmentation.source_properties</span></code>, these all occur inside the lco_fakeSNpipeline.source_cat function, but first need to define the detection parameters</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nsigma</span><span class="p">,</span><span class="n">kernel_size</span><span class="p">,</span><span class="n">npixels</span><span class="p">,</span><span class="n">deblend</span><span class="p">,</span><span class="n">contrast</span><span class="p">,</span><span class="n">targ_coord</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">L1fwhm</span><span class="o">/</span><span class="n">pixscale</span><span class="p">)),</span><span class="kc">False</span><span class="p">,</span><span class="o">.</span><span class="mi">001</span><span class="p">,</span><span class="kc">None</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Source Catalog using nsigma ~ </span><span class="si">{}</span><span class="s1"> (detection threshold above img bkg), gaussian kernel sized ~ </span><span class="si">{}</span><span class="s1"> pix, npixels ~ </span><span class="si">{}</span><span class="s1"> (connected pixels needed to be considered source), deblend ~ </span><span class="si">{}</span><span class="s1"> w contrast </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nsigma</span><span class="p">,</span><span class="n">kernel_size</span><span class="p">,</span><span class="n">npixels</span><span class="p">,</span><span class="n">deblend</span><span class="p">,</span><span class="n">contrast</span><span class="p">))</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">placeholder</span>
</pre></div>
</div>
<p>Now run lco_fakeSNpipeline.source_cat to find the objects in image meeting criteria for detection</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source_catalog</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">source_cat</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">nsigma</span><span class="o">=</span><span class="n">nsigma</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span><span class="n">npixels</span><span class="o">=</span><span class="n">npixels</span><span class="p">,</span><span class="n">deblend</span><span class="o">=</span><span class="n">deblend</span><span class="p">,</span><span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span><span class="n">targ_coord</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">cat</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">threshold</span><span class="p">,</span><span class="n">segm</span><span class="p">,</span><span class="n">targ_obj</span> <span class="o">=</span> <span class="n">source_catalog</span> <span class="c1"># unpacked to make a little clearer</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">placeholder</span>
</pre></div>
</div>
<p>In a general case these objects from the catalog could be restricted to provide point sources, however in the case of this LCO survey done in rp, the positions of stars measured in similar filter are readily available <code class="xref py py-class docutils literal notranslate"><span class="pre">Gaia.query_object_async</span></code>, the results of the Gaia query within the image fov are taken</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">gaia_results</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">gaia</span><span class="p">,</span><span class="n">image</span> <span class="o">=</span> <span class="n">results</span> <span class="c1"># unpacked</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">placeholder</span>
</pre></div>
</div>
<p>Cutouts around these stars are extracted from the image after passing criteria including that they are not overlapping with other sources and have a flux which is below the LCO detector saturation/non-linearity but still gave a strong signal in Gaia.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extracted_stars</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">stars</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">good_stars</span><span class="p">,</span><span class="n">image</span> <span class="o">=</span> <span class="n">extracted_stars</span> <span class="c1"># unpacked</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">placeholder</span>
</pre></div>
</div>
<p>Finally, the effective point spread function is constructed for these stars using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.psf.EPSFBuilder</span></code>. A 2D-Gaussian is fit to the resulting epsf using <code class="xref py py-class docutils literal notranslate"><span class="pre">photutils.centroids.GaussianConst2D</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">EPSF</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">ePSF</span><span class="p">(</span><span class="n">extracted_stars</span><span class="p">,</span><span class="n">oversampling</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">epsf</span><span class="p">,</span><span class="n">fitted_stars</span> <span class="o">=</span> <span class="n">EPSF</span> <span class="c1"># unpacked</span>
    <span class="n">epsf_gaussian</span> <span class="o">=</span> <span class="n">lco_fakeSNpipeline</span><span class="o">.</span><span class="n">gaussian2d</span><span class="p">(</span><span class="n">epsf</span><span class="p">)</span>
<span class="n">fit_gaussian</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">xctr_vals</span><span class="p">,</span><span class="n">yctr_vals</span><span class="p">,</span><span class="n">image1</span><span class="p">,</span><span class="n">img_epsf</span><span class="p">,</span><span class="n">resid</span> <span class="o">=</span> <span class="n">epsf_gaussian</span> <span class="c1"># unpacked... levels list amplitude - sigma, ctr vals are gauss model sliced, image1 is array of values from gaussian fit in shape of epsf, img_epsf is epsf instance of it, resid is gauss - epsf</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">placeholder</span>
</pre></div>
</div>
<p>Images showing the epsf against fitted gaussian, as well as the extracted stars that went into the epsf are made.</p>
<a class="reference internal image-reference" href="_images/cpt1m010-fa16-20200816-0229-e91_trim_psf.png"><img alt="alternate text" class="align-center" src="_images/cpt1m010-fa16-20200816-0229-e91_trim_psf.png" style="width: 600px; height: 600px;" /></a>
<a class="reference internal image-reference" href="_images/cpt1m010-fa16-20200816-0229-e91_trim_stars.png"><img alt="alternate text" class="align-center" src="_images/cpt1m010-fa16-20200816-0229-e91_trim_stars.png" style="width: 600px; height: 600px;" /></a>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples/plot_package.html" class="btn btn-neutral float-right" title="Basic Functionality" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020 Kyle OConnor

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>